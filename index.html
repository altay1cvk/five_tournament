<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tournoi Five</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Réinitialisation (reset) des styles par défaut */
        * {  margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: #111; color: #fff; line-height: 1.6; padding-bottom: 80px;}
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background-color: #222; border-top: 1px solid #444; display: flex; justify-content: space-around; align-items: center; padding: 0.85rem 0; z-index: 100; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3); }
        .bottom-nav a { color: #aaa; text-decoration: none; display: flex; flex-direction: column; align-items: center; font-size: 0.85rem; transition: color 0.2s; padding: 0.5rem; width: 25%; text-align: center; }
        .bottom-nav a i { font-size: 1.3rem; margin-bottom: 0.2rem; }
        .bottom-nav a.active { color: #00aaff; }
        #hero { background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.7)), url('https://source.unsplash.com/random/800x600/?soccer') center/cover no-repeat; height: 60vh; display: flex; justify-content: center; align-items: center; text-align: center; padding: 1rem; }
        .hero-content { max-width: 800px; background-color: rgba(0, 0, 0, 0.7); padding: 1.5rem; border-radius: 10px; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); }
        .hero-content h2 { font-size: 2.2rem; margin-bottom: 0.8rem; text-shadow: 0 0 10px rgba(0, 170, 255, 0.8); }
        .hero-content p { font-size: 1.1rem; margin-bottom: 1rem; }
        .cta-button { display: inline-block; background-color: #00aaff; color: #fff; padding: 0.8rem 1.5rem; border-radius: 5px; text-decoration: none; transition: all 0.3s; font-size: 1rem; font-weight: bold; border: none; cursor: pointer; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); }
        .cta-button:hover, .cta-button:active { background-color: #0077cc; transform: translateY(-2px); }
        section { margin-top: 2rem; padding: 1rem; text-align: center; }
        section h2 { margin-bottom: 5px; position: relative; display: inline-block; padding-bottom: 0.5rem; }
        section h2::after { content: ''; position: absolute; bottom: 0; left: 25%; right: 25%; height: 3px; background: linear-gradient(to right, transparent, #00aaff, transparent); }
        .roadmap-container { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 800px; margin: 0 auto; padding: 0; }
        .match-group { display: flex; flex-direction: column; align-items: center; width: 100%; margin: 10px 0; }
        .match { border: 1px solid #00aaff; padding: 0.7rem; margin: 5px; border-radius: 5px; width: 140px; text-align: center; background-color: #222; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); transition: all 0.3s; }
        .match:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 170, 255, 0.3); }
        .bracket-row { display: flex; flex-direction: column; align-items: center; width: 100%; margin: 5px 0; }
        .arrow { color: #00aaff; font-size: 1.3rem; margin: 5px; }
        .match-group.perdant { margin-top: 20px; border-top: 1px dashed #444; padding-top: 20px; width: 100%; }
        .inscription-container { display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px; width: 100%; max-width: 900px; margin: 0 auto; }
        .equipe { margin: 0.5rem; border: 1px solid #444; padding: 1rem; border-radius: 8px; width: 90%; max-width: 500px; background-color: #222; transition: transform 0.3s; }
        .equipe:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        .equipe p { font-weight: bold; margin-bottom: 0.5rem; font-size: 1.1rem; color: #00aaff; }
        .membres { list-style: none; padding-left: 0; margin-top: 0.5rem; }
        .membres li { margin-bottom: 0.5rem; min-height: 1.2em; padding: 0.5rem; border-radius: 4px; background-color: #333; }
        .form-container { max-width: 95%; margin: 1rem auto; padding: 1.5rem; background-color: rgba(0, 0, 0, 0.7); border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        .form-container h2 { font-size: 1.8rem; margin-bottom: 1rem; text-align: center; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.3rem; font-size: 0.95rem; color: #ccc; }
        .form-group input[type="text"], .form-group input[type="email"], .form-group input[type="tel"], .form-group input[type="number"], .form-group select,.form-group input[type="password"] { width: 100%; padding: 0.8rem; border: 1px solid #444; background-color: #333; color: #fff; border-radius: 5px; font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #00aaff; box-shadow: 0 0 0 2px rgba(0, 170, 255, 0.3); }
        #message { margin-top: 1rem; padding: 0.8rem; border-radius: 5px; font-weight: bold; }
        footer { text-align: center; padding: 1.5rem; margin-top: 3rem; border-top: 1px solid #444; font-size: 0.9rem; color: #aaa; }
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #00aaff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 0 auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (min-width: 768px) {
            body { padding-bottom: 60px; } #hero { padding: 2rem; height: 70vh; }
            .hero-content { padding: 2.5rem; }
            .hero-content h2 { font-size: 3rem; }
            .hero-content p { font-size: 1.2rem; }
            .cta-button { padding: 1rem 2rem; font-size: 1.1rem; }
            .bracket-row { flex-direction: row; justify-content: center; }
            .inscription-container{ flex-direction: row; flex-wrap: wrap; }
            .equipe { width: 45%; }
            .form-container { max-width: 600px; padding: 2rem; }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        section { animation: fadeIn 0.5s ease-out; }

        /* Styles pour les étapes du tournoi */
        .match-step {
            margin-top: 20px; /* Espacement cohérent */
            width: 100%;
            display: none; /* Masqué par défaut */
        }

        .match-step.active {
            display: block; /* Affiché quand actif */
            animation: fadeInUp 0.5s ease-out;
        }

        .step-title {
            color: #00aaff;
            font-weight: bold;
            margin-bottom: 10px; /* Marge inférieure pour espacer du contenu */
            background-color: rgba(0, 170, 255, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            display: block; /* Changé de inline-block à block */
            text-align: center; /* Centrer le titre */
        }

        .match-time {
            font-size: 0.8rem;
            color: #00aaff;
            margin-top: 5px;
            font-weight: bold;
        }

        .match-duration {
            font-size: 0.7rem;
            color: #aaa;
        }

        .classement {
            margin-top: 40px !important; /* Augmenté et !important */
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px dashed #00aaff;
        }

        .classement h3 {
            margin-bottom: 15px;
            color: #00aaff;
        }

        .classement ol {
            text-align: left;
            padding-left: 30px;
        }

        .classement li {
            margin-bottom: 8px;
        }
        
        .delete-player-btn {
            margin-left: 10px;
            background: #ff3c3c;
            border: none;
            border-radius: 3px;
            color: white;
            padding: 2px 5px;
            cursor: pointer;
        }

         /* Styles pour le compte à rebours */
         .countdown-timer {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #00aaff;
            border: 1px solid rgba(0, 170, 255, 0.3);
            box-shadow: 0 0 10px rgba(0, 170, 255, 0.2);
        }

        /* Styles pour l'affichage des scores */
        .score-display {
            font-weight: bold;
            color: #fff;
            background-color: rgba(0, 170, 255, 0.3);
            padding: 3px 8px;
            border-radius: 4px;
            margin: 5px 0;
            display: inline-block;
        }

        /* Style pour le formulaire d'administration */
        .admin-form-container {
            background-color: rgba(0, 0, 0, 0.8);
            border: 1px solid #00aaff;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .admin-form-container h3 {
            color: #00aaff;
            margin-bottom: 15px;
        }

        .admin-form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .admin-form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
        }

        .admin-form-group input {
            width: 60px;
            padding: 8px;
            border: 1px solid #444;
            background-color: #333;
            color: #fff;
            border-radius: 4px;
            text-align: center;
        }

        .team-name {
            display: inline-block;
            width: 120px;
            text-align: right;
            margin-right: 10px;
        }

        .vs {
            display: inline-block;
            margin: 0 10px;
            color: #aaa;
        }

        /* Style pour les formulaires de gestion d'équipe (capitaine) */
        .team-management-container {
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid #00aaff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
        }

        .team-management-container h3 {
            color: #00aaff;
            margin-bottom: 10px;
        }

        .team-management-form label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
        }
          .team-management-form input[type="text"],
        .team-management-form input[type="password"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #444;
            background-color: #333;
            color: #fff;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .team-management-form button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            color: white;
            background-color: #00aaff;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .team-management-form button:hover {
            background-color: #0077cc;
        }

          /* Style pour le message d'erreur/succès */
        .message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }

        .message.error {
            color: #ff3c3c;
            background-color: rgba(255, 60, 60, 0.2);
        }

        .message.success {
            color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.2);
        }
    </style>
</head>
<body>
    <nav class="bottom-nav">
        <a href="#hero" class="nav-item active"><i class="fas fa-home"></i> Accueil</a>
        <a href="#roadmap" class="nav-item"><i class="fas fa-sitemap"></i> Matchs</a>
        <a href="#inscription-section" class="nav-item"><i class="fas fa-user-plus"></i> Inscription</a>
        <a href="#liste-inscrits" class="nav-item"><i class="fas fa-users"></i> Équipes</a>
    </nav>

    <main>
        <section id="hero">
            <div class="hero-content">
                <h2>Tournoi Five</h2>
                <p>Arena 25, Montbéliard</p>
                <p>Dimanche 6 avril 2025</p>
                <p>15h00 - 16h30</p>
                <p>3 matchs de 30 min par équipe</p>
                <div id="countdown" class="countdown-timer">Chargement du compte à rebours...</div>
                <a href="#inscription-section" class="cta-button">S'inscrire maintenant</a>
                <button id="add-to-calendar-btn" class="cta-button">Ajouter au calendrier</button>
            </div>
        </section>

        <section id="roadmap">
           <h2>Déroulement des Matchs</h2>
            <div class="roadmap-container">
                <!-- Étape 1: Quarts de finale -->
                <div class="match-step" id="step1">
                    <div class="step-title">Étape 1: Quarts de finale (15h00)</div>
                    <div class="bracket-row">
                        <div class="match-group">
                            <div class="match" id="match1">
                                <span class="team1-name">Équipe 1</span> vs <span class="team2-name">Équipe 2</span>
                                <div class="match-time">15h00</div>
                                <div class="match-duration">30 min</div>
                                    <div id="score-match1" class="score-display"></div>
                            </div>
                        </div>
                        <div class="match-group">
                            <div class="match" id="match2">
                                <span class="team3-name">Équipe 3</span> vs <span class="team4-name">Équipe 4</span>
                                <div class="match-time">15h00</div>
                                <div class="match-duration">30 min</div>
                                <div id="score-match2" class="score-display"></div>
                            </div>
                        </div>
                            <div class="match-group">
                            <div class="match" id="match3">
                               <span class="team5-name">Équipe 5</span> vs <span class="team6-name">Équipe 6</span>
                                <div class="match-time">15h00</div>
                                <div class="match-duration">30 min</div>
                                    <div id="score-match3" class="score-display"></div>
                            </div>
                        </div>
                        <div class="match-group">
                            <div class="match" id="match4">
                                <span class="team7-name">Équipe 7</span> vs <span class="team8-name">Équipe 8</span>
                                <div class="match-time">15h00</div>
                                <div class="match-duration">30 min</div>
                                <div id="score-match4" class="score-display"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 2: Demi-finales -->
                <div class="match-step" id="step2">
                    <div class="step-title">Étape 2: Demi-finales (15h30)</div>
                    <div class="bracket-row">
                        <div class="match-group">
                            <div class="match" id="demi-finale-principale1">
                                 <span id="demi1-team1"></span> vs <span id="demi1-team2"></span>
                                <div class="match-time">15h30</div>
                                <div class="match-duration">30 min</div>
                                <div id="score-demi-finale-principale1" class="score-display"></div>
                            </div>
                        </div>
                        <div class="match-group">
                            <div class="match" id="demi-finale-principale2">
                                <span id="demi2-team1"></span> vs <span id="demi2-team2"></span>
                                <div class="match-time">15h30</div>
                                <div class="match-duration">30 min</div>
                                <div id="score-demi-finale-principale2" class="score-display"></div>
                            </div>
                        </div>
                    </div>

                    <div class="step-title">Étape 2: Demi-finales Consolantes(15h30)</div>
                    <div class="bracket-row">
                        <div class="match-group">
                            <div class="match" id="demi-finale-consolante1">
                                 <span id="demiC1-team1"></span> vs <span id="demiC1-team2"></span>
                                <div class="match-time">15h30</div>
                                <div class="match-duration">30 min</div>
                                <div id="score-demi-finale-consolante1" class="score-display"></div>
                            </div>
                        </div>
                        <div class="match-group">
                            <div class="match" id="demi-finale-consolante2">
                                <span id="demiC2-team1"></span> vs <span id="demiC2-team2"></span>
                                <div class="match-time">15h30</div>
                                <div class="match-duration">30 min</div>
                                <div id="score-demi-finale-consolante2" class="score-display"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Étape 3: Finales -->
        <div class="match-step" id="step3">
            <div class="step-title">Étape 3: Finale 1 (16h00) - Places 1 & 2</div>
                <div class="match-group">
                    <div class="match" id="match-finale1">
                         <span id="finale-team1"></span> vs <span id="finale-team2"></span>
                        <div class="match-time">16h00</div>
                        <div class="match-duration">30 min</div>
                        <div id="score-finale" class="score-display"></div>
                    </div>
                </div>

            <div class="step-title">Étape 3: Finale 2 (16h00) - Places 3 & 4</div>
                <div class="match-group">
                    <div class="match" id="match-finale2">
                         <span id="finale2-team1"></span> vs <span id="finale2-team2"></span>
                        <div class="match-time">16h00</div>
                        <div class="match-duration">30 min</div>
                        <div id="score-finale2" class="score-display"></div>
                    </div>
                </div>
            
            <div class="step-title">Étape 3: Finale 3 (16h00) - Places 5 & 6</div>
                <div class="match-group">
                    <div class="match" id="match-finale3">
                         <span id="finaleC-team1"></span> vs <span id="finaleC-team2"></span>
                        <div class="match-time">16h00</div>
                        <div class="match-duration">30 min</div>
                        <div id="score-finale3" class="score-display"></div>
                    </div>
                </div>

            <div class="step-title">Étape 3: Finale 4 (16h00) - Places 7 & 8</div>
                <div class="match-group">
                    <div class="match" id="match-finale4">
                         <span id="finaleC2-team1"></span> vs <span id="finaleC2-team2"></span>
                        <div class="match-time">16h00</div>
                        <div class="match-duration">30 min</div>
                        <div id="score-finale4" class="score-display"></div>
                    </div>
                </div>
        </div>

                <div class="match-step" id="step4">
                    <div class="classement">
                        <h3>Classement final</h3>
                        <ol id="final-ranking">
                            <!-- Le classement sera mis à jour dynamiquement -->
                        </ol>
                    </div>
                </div>

                <button id="nextStep" class="cta-button" style="margin-top: 0px;">Étape suivante</button>
                <button id="adminScoreBtn" class="cta-button" style="margin-top: 15px; background-color: #444;">Administration des scores</button>
                 <button id="resetScoresBtn" class="cta-button" style="margin-top: 15px; background-color: #ff3c3c;">Réinitialiser les scores (Admin)</button>
            </div>
        </section>

        <section id="inscription-section">
            <h2>Inscription (Capitaine)</h2>
            <div class="form-container">
                <p>Prix total (par personne) : 7€ </p>
                 <!-- Formulaire SANS Formspree -->
                 <form id="inscriptionForm">
                    <div class="form-group">
                        <label for="nomEquipe">Nom de l'équipe :</label>
                        <input type="text" id="nomEquipe" name="nomEquipe" required>
                    </div>
                     <div class="form-group">
                            <label for="teamPassword">Mot de passe de l'équipe :</label>
                            <input type="password" id="teamPassword" name="teamPassword" required>
                        </div>
                    <div class="form-group">
                        <label for="nomCapitaine">Nom du Capitaine :</label>
                        <input type="text" id="nomCapitaine" name="nomCapitaine" required autocomplete="family-name">
                    </div>
                    <div class="form-group">
                        <label for="prenomCapitaine">Prénom du Capitaine :</label>
                        <input type="text" id="prenomCapitaine" name="prenomCapitaine" required autocomplete="given-name">
                    </div>
                    <div class="form-group">
                        <label for="emailCapitaine">Email du Capitaine :</label>
                        <input type="email" id="emailCapitaine" name="emailCapitaine" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="telephoneCapitaine">Téléphone du Capitaine :</label>
                        <input type="tel" id="telephoneCapitaine" name="telephoneCapitaine" required pattern="[0-9]{10}" title="Veuillez entrer un numéro de téléphone à 10 chiffres" autocomplete="tel">
                    </div>
                    <div class="form-group">
                        <label for="ageCapitaine">Âge du Capitaine :</label>
                        <input type="number" id="ageCapitaine" name="ageCapitaine" required min="1" max="120">
                    </div>
                      <div class="form-group">
                        <label for="equipe">Équipe:</label>
                        <select id="equipe" name="equipe" required>
                            <option value="">-- Sélectionnez une équipe --</option>
                            <option value="equipe1">Équipe 1</option>
                            <option value="equipe2">Équipe 2</option>
                            <option value="equipe3">Équipe 3</option>
                            <option value="equipe4">Équipe 4</option>
                            <option value="equipe5">Équipe 5</option>
                            <option value="equipe6">Équipe 6</option>
                            <option value="equipe7">Équipe 7</option>
                            <option value="equipe8">Équipe 8</option>
                        </select>
                    </div>
                    <button type="submit" class="cta-button">Inscrire l'équipe</button>
                    <div class="loader" id="formLoader"></div>
                </form>
                <div id="message" class="message"></div> <!-- Ajout de la classe message -->
            </div>
        </section>

        <section id="liste-inscrits">
           <h2>Liste des équipes</h2>
            <div class="inscription-container" id="equipes-container">
                <!-- Les équipes et leurs joueurs seront ajoutés ici dynamiquement -->
            </div>
        </section>
    </main>

    <footer>
        <p>© 2024 Tournoi Five. Tous droits réservés.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";
        import { getDatabase, ref, set, onValue, push, serverTimestamp, remove, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

      const firebaseConfig = {
            apiKey: "AIzaSyAWNBsqJRT2l4bebJCku-W8SsYWxIe6zko",
            authDomain: "tournoifoot-e233b.firebaseapp.com",
            projectId: "tournoifoot-e233b",
            storageBucket: "tournoifoot-e233b.firebasestorage.app",
            messagingSenderId: "915558317701",
            appId: "1:915558317701:web:51b0b0d303f7989bfbb3ec",
            measurementId: "G-N5NWTN317Y"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

// Fonction pour démarrer le compte à rebours
function startCountdown() {
    const tournamentDate = new Date("April 6, 2025 15:00:00").getTime();
    const countdownElement = document.getElementById('countdown');
    const countdownInterval = setInterval(() => {
        const now = new Date().getTime();
        const distance = tournamentDate - now;

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        let countdownText = "<div>Début du tournoi dans: ";
        if (days > 0) {
            countdownText += `${days}j `;
        }
        countdownText += `${hours}h ${minutes}m ${seconds}s</div>`;

        countdownElement.innerHTML = countdownText;

        if (distance < 0) {
            clearInterval(countdownInterval);
            countdownElement.innerHTML = "Le tournoi a commencé!";
        }
    }, 1000);
}

// MODIFICATION ICI : Ajout du choix du type de calendrier
function generateCalendarUrl(type) {
        const eventDetails = {
            title: "Tournoi Five - Convocation",
            start: "20250406T143000", // 14h30 (heure de convocation)
            end: "20250406T170000",   // 17h00 (estimation de fin, ajustez si besoin)
            details: "Convocation pour le Tournoi Five à l'Arena 25. Début des matchs à 15h00.\nAdresse: Arena 25, 2 rue Pierre Donzelot, Montbéliard",
            location: "Arena 25, 2 rue Pierre Donzelot, Montbéliard"
        };

        let calendarUrl = "";

        switch (type) {
            case 'google':
                calendarUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventDetails.title)}&dates=${eventDetails.start}/${eventDetails.end}&details=${encodeURIComponent(eventDetails.details)}&location=${encodeURIComponent(eventDetails.location)}`;
                break;
            case 'ics': // Format iCalendar (pour Apple Calendar, Outlook, etc.)
                const icsData = [
                    'BEGIN:VCALENDAR',
                    'VERSION:2.0',
                    'PRODID:-//hacksw/handcal//NONSGML v1.0//EN',
                    'BEGIN:VEVENT',
                    `UID:${Math.random().toString()}`,
                    `DTSTAMP:${new Date().toISOString().replace(/[-:]/g, '').split('.')[0]}Z`,
                    `DTSTART:${eventDetails.start}`,
                    `DTEND:${eventDetails.end}`,
                    `SUMMARY:${eventDetails.title}`,
                    `DESCRIPTION:${eventDetails.details}`,
                    `LOCATION:${eventDetails.location}`,
                    'END:VEVENT',
                    'END:VCALENDAR'
                ].join('\r\n');

                const blob = new Blob([icsData], { type: 'text/calendar;charset=utf-8' });
                calendarUrl = URL.createObjectURL(blob);

                const downloadLink = document.createElement('a');
                downloadLink.href = calendarUrl;
                downloadLink.download = 'tournoi_five.ics';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                return; // Arrêt après téléchargement

            default:
                console.error('Type de calendrier non supporté.');
                return;
        }
        window.open(calendarUrl, '_blank');
    }

// Fonction pour afficher le formulaire d'administration des scores
function showAdminScoreForm() {
    const password = prompt("Entrez le mot de passe admin:");
    if (password === 'ditib25five') { // Mot de passe admin global
        const adminForm = document.createElement('div');
        adminForm.className = 'admin-form-container';
        adminForm.innerHTML = `
            <h3>Administration des scores</h3>
            <form id="scoreForm">
                <!-- Quarts de finale -->
                <div class="admin-form-group">
                    <label>Match 1:</label>
                    <span class="team-name" id="team1-name"></span> <input type="number" id="score-equipe1" min="0" required>
                    <span class="vs">vs</span>
                    <input type="number" id="score-equipe2" min="0" required> <span class="team-name" id="team2-name"></span>
                </div>
                <div class="admin-form-group">
                    <label>Match 2:</label>
                    <span class="team-name" id="team3-name"></span> <input type="number" id="score-equipe3" min="0" required>
                    <span class="vs">vs</span>
                    <input type="number" id="score-equipe4" min="0" required> <span class="team-name" id="team4-name"></span>
                </div>
                <div class="admin-form-group">
                    <label>Match 3:</label>
                    <span class="team-name" id="team5-name"></span> <input type="number" id="score-equipe5" min="0" required>
                    <span class="vs">vs</span>
                    <input type="number" id="score-equipe6" min="0" required> <span class="team-name" id="team6-name"></span>
                </div>
                <div class="admin-form-group">
                    <label>Match 4:</label>
                    <span class="team-name" id="team7-name"></span> <input type="number" id="score-equipe7" min="0" required>
                    <span class="vs">vs</span>
                    <input type="number" id="score-equipe8" min="0" required> <span class="team-name" id="team8-name"></span>
                </div>

                <!-- Demi-finales principales (inputs initialement cachés) -->
                <div class="admin-form-group" style="display:none;">
                    <label>Demi-finale 1:</label>
                    <span class="team-name" id="demi1-team1"></span> <input type="number" id="score-demi1-1" min="0">
                    <span class="vs">vs</span>
                    <input type="number" id="score-demi1-2" min="0"> <span class="team-name" id="demi1-team2"></span>
                </div>
                <div class="admin-form-group" style="display:none;">
                    <label>Demi-finale 2:</label>
                    <span class="team-name" id="demi2-team1"></span> <input type="number" id="score-demi2-1" min="0">
                    <span class="vs">vs</span>
                    <input type="number" id="score-demi2-2" min="0"> <span class="team-name" id="demi2-team2"></span>
                </div>

                 <!-- Demi-finales consolantes (inputs initialement cachés) -->
                <div class="admin-form-group" style="display:none;">
                    <label>Demi-finale Consolante 1:</label>
                    <span class="team-name" id="demiC1-team1"></span> <input type="number" id="score-demiC1-1" min="0">
                    <span class="vs">vs</span>
                    <input type="number" id="score-demiC1-2" min="0"> <span class="team-name" id="demiC1-team2"></span>
                </div>
                <div class="admin-form-group" style="display:none;">
                    <label>Demi-finale Consolante 2:</label>
                    <span class="team-name" id="demiC2-team1"></span> <input type="number" id="score-demiC2-1" min="0">
                    <span class="vs">vs</span>
                    <input type="number" id="score-demiC2-2" min="0"> <span class="team-name" id="demiC2-team2"></span>
                </div>

                <!-- Finale et Finale Consolante (inputs initialement cachés) -->
                <div class="admin-form-group" style="display:none;">
                    <label>Finale 1:</label>
                    <span class="team-name" id="finale-team1"></span> <input type="number" id="score-finale-1" min="0">
                    <span class="vs">vs</span>
                    <input type="number" id="score-finale-2" min="0"> <span class="team-name" id="finale-team2"></span>
                </div>
                <div class="admin-form-group" style="display:none;">
                    <label>Finale 2 :</label>
                    <span class="team-name" id="finale2-team1"></span> <input type="number" id="score-finale2-1" min="0">
                    <span class="vs">vs</span>
                    <input type="number" id="score-finale2-2" min="0"> <span class="team-name" id="finale2-team2"></span>
                </div>
                <div class="admin-form-group" style="display:none;">
                    <label>Finale 3:</label>
                    <span class="team-name" id="finaleC-team1"></span> <input type="number" id="score-finaleC-1" min="0">
                    <span class="vs">vs</span>
                    <input type="number" id="score-finaleC-2" min="0"> <span class="team-name" id="finaleC-team2"></span>
                </div>
                <div class="admin-form-group" style="display:none;">
                    <label>Finale 4:</label>
                    <span class="team-name" id="finaleC2-team1"></span> <input type="number" id="score-finaleC2-1" min="0">
                    <span class="vs">vs</span>
                    <input type="number" id="score-finaleC2-2" min="0"> <span class="team-name" id="finaleC2-team2"></span>
                </div>
                <button type="submit" class="cta-button">Enregistrer les scores</button>
            </form>
        `;
        document.getElementById('roadmap').appendChild(adminForm);
        document.getElementById('scoreForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveScores();
        });

        // Pré-remplir les noms d'équipe dans le formulaire admin
        loadTeamNamesForAdmin();


    } else {
        alert('Mot de passe incorrect');
    }
}

//Fonction pour préremplir les noms dans admin
function loadTeamNamesForAdmin() {
    const teamNames = {};

    // Récupérer les noms des équipes depuis Firebase
    const equipesRef = ref(database, 'equipes');
    get(equipesRef).then((snapshot) => {
        if (snapshot.exists()) {
            const equipes = snapshot.val();
            for (const equipeId in equipes) {
                //Trouver dans quel match l'équipe est
                const teamNumber = parseInt(equipeId.replace('equipe', ''));
                teamNames[teamNumber] = equipes[equipeId].nomEquipe;
            }
          // Mettre à jour les noms dans le formulaire
          for (let i = 1; i <= 8; i++) {
            const teamNameElement = document.getElementById(`team${i}-name`);
            if (teamNameElement && teamNames[i]) {
                teamNameElement.textContent = teamNames[i];
            }
          }
        }
    });
}


// Fonction pour enregistrer les scores et mettre à jour le tournoi
function saveScores() {
    // 1. Récupérer et enregistrer les scores des QUARTS DE FINALE
    const scoresQuarts = {
        match1: { equipe1: document.getElementById('score-equipe1').value, equipe2: document.getElementById('score-equipe2').value },
        match2: { equipe3: document.getElementById('score-equipe3').value, equipe4: document.getElementById('score-equipe4').value },
        match3: { equipe5: document.getElementById('score-equipe5').value, equipe6: document.getElementById('score-equipe6').value },
        match4: { equipe7: document.getElementById('score-equipe7').value, equipe8: document.getElementById('score-equipe8').value }
    };

    for (const matchId in scoresQuarts) {
        set(ref(database, 'scores/' + matchId), scoresQuarts[matchId]);
        // Pas besoin de mettre à jour l'affichage ici, onValue s'en charge
    }


    // 2. Déterminer les gagnants/perdants des QUARTS et mettre à jour les DEMI-FINALES
    const winners = {};
    const losers = {};
      for (let i = 1; i <= 4; i++) {
        const team1Name = document.getElementById(`team${i * 2 - 1}-name`).textContent;
        const team2Name = document.getElementById(`team${i * 2}-name`).textContent;
        const score1 = parseInt(scoresQuarts[`match${i}`][`equipe${i * 2 - 1}`]);
        const score2 = parseInt(scoresQuarts[`match${i}`][`equipe${i * 2}`]);

        winners[`match${i}`] = score1 > score2 ? team1Name : team2Name;
        losers[`match${i}`] = score1 > score2 ? team2Name : team1Name;
    }

    // Mettre à jour les *noms* des équipes dans les demi-finales (AVANT de récupérer les scores)
    document.getElementById('demi1-team1').textContent = winners.match1;
    document.getElementById('demi1-team2').textContent = winners.match2;
    document.getElementById('demi2-team1').textContent = winners.match3;
    document.getElementById('demi2-team2').textContent = winners.match4;
    document.getElementById('demiC1-team1').textContent = losers.match1;
    document.getElementById('demiC1-team2').textContent = losers.match2;
    document.getElementById('demiC2-team1').textContent = losers.match3;
    document.getElementById('demiC2-team2').textContent = losers.match4;

      // Pré-remplir les spans des demi-finales dans le formulaire admin
    document.getElementById('demi1-team1').textContent = winners.match1;
    document.getElementById('demi1-team2').textContent = winners.match2;
    document.getElementById('demi2-team1').textContent = winners.match3;
    document.getElementById('demi2-team2').textContent = winners.match4;
    document.getElementById('demiC1-team1').textContent = losers.match1;
    document.getElementById('demiC1-team2').textContent = losers.match2;
    document.getElementById('demiC2-team1').textContent = losers.match3;
    document.getElementById('demiC2-team2').textContent = losers.match4;

    // Afficher les inputs des demi-finales (maintenant qu'on a les noms)
    const demiFinalesInputs = document.querySelectorAll('.admin-form-group[style="display:none;"]');
    demiFinalesInputs.forEach(inputGroup => inputGroup.style.display = 'block');


    // 3. Récupérer et enregistrer les scores des DEMI-FINALES
    const scoresDemis = {
        demiPrincipale1: { equipe1: document.getElementById('score-demi1-1').value, equipe2: document.getElementById('score-demi1-2').value },
        demiPrincipale2: { equipe1: document.getElementById('score-demi2-1').value, equipe2: document.getElementById('score-demi2-2').value },
        demiConsolante1: { equipe1: document.getElementById('score-demiC1-1').value, equipe2: document.getElementById('score-demiC1-2').value },
        demiConsolante2: { equipe1: document.getElementById('score-demiC2-1').value, equipe2: document.getElementById('score-demiC2-2').value }
    };

    for (const demiId in scoresDemis) {
        set(ref(database, 'scores/' + demiId), scoresDemis[demiId]);
        // Pas de mise à jour de l'affichage ici, onValue s'en charge
    }


    // 4. Déterminer les équipes pour TOUTES les FINALES
    const winnerDemi1 = parseInt(scoresDemis.demiPrincipale1.equipe1 || 0) > parseInt(scoresDemis.demiPrincipale1.equipe2 || 0) ? winners.match1 : winners.match2;
    const loserDemi1  = parseInt(scoresDemis.demiPrincipale1.equipe1 || 0) > parseInt(scoresDemis.demiPrincipale1.equipe2 || 0) ? winners.match2 : winners.match1;
    const winnerDemi2 = parseInt(scoresDemis.demiPrincipale2.equipe1 || 0) > parseInt(scoresDemis.demiPrincipale2.equipe2 || 0) ? winners.match3 : winners.match4;
    const loserDemi2  = parseInt(scoresDemis.demiPrincipale2.equipe1 || 0) > parseInt(scoresDemis.demiPrincipale2.equipe2 || 0) ? winners.match4 : winners.match3;
    const winnerDemiC1 = parseInt(scoresDemis.demiConsolante1.equipe1 || 0) > parseInt(scoresDemis.demiConsolante1.equipe2 || 0) ? losers.match1 : losers.match2;
    const loserDemiC1_ = parseInt(scoresDemis.demiConsolante1.equipe1 || 0) > parseInt(scoresDemis.demiConsolante1.equipe2 || 0) ? losers.match2 : losers.match1;
    const winnerDemiC2 = parseInt(scoresDemis.demiConsolante2.equipe1 || 0) > parseInt(scoresDemis.demiConsolante2.equipe2 || 0) ? losers.match3 : losers.match4;
    const loserDemiC2_ = parseInt(scoresDemis.demiConsolante2.equipe1 || 0) > parseInt(scoresDemis.demiConsolante2.equipe2 || 0) ? losers.match4 : losers.match3;


    // 5. Mettre à jour les *noms* des équipes pour les FINALES (AVANT de récupérer les scores)
    document.getElementById('finale-team1').textContent = winnerDemi1;
    document.getElementById('finale-team2').textContent = winnerDemi2;
    document.getElementById('finale2-team1').textContent = loserDemi1;
    document.getElementById('finale2-team2').textContent = loserDemi2;
    document.getElementById('finaleC-team1').textContent = winnerDemiC1;
    document.getElementById('finaleC-team2').textContent = winnerDemiC2;
    document.getElementById('finaleC2-team1').textContent = loserDemiC1_;
    document.getElementById('finaleC2-team2').textContent = loserDemiC2_;

     // Pré-remplir les spans des finales dans le formulaire
    document.getElementById('finale-team1').textContent = winnerDemi1;
    document.getElementById('finale-team2').textContent = winnerDemi2;
    document.getElementById('finale2-team1').textContent = loserDemi1;
    document.getElementById('finale2-team2').textContent = loserDemi2;
    document.getElementById('finaleC-team1').textContent = winnerDemiC1;
    document.getElementById('finaleC-team2').textContent = winnerDemiC2;
    document.getElementById('finaleC2-team1').textContent = loserDemiC1_;
    document.getElementById('finaleC2-team2').textContent = loserDemiC2_;


    // Afficher les inputs des finales (maintenant qu'on a les noms)
    const finaleInputs = document.querySelectorAll('.admin-form-group[style="display:none;"]');
     finaleInputs.forEach(inputGroup => inputGroup.style.display = 'block');


    // 6. Récupérer et enregistrer les scores des FINALES
    const scoresFinales = {
        finale1: { equipe1: document.getElementById('score-finale-1').value, equipe2: document.getElementById('score-finale-2').value },
        finale2: { equipe1: document.getElementById('score-finale2-1').value, equipe2: document.getElementById('score-finale2-2').value },
        finale3: { equipe1: document.getElementById('score-finaleC-1').value, equipe2: document.getElementById('score-finaleC-2').value },
        finale4: { equipe1: document.getElementById('score-finaleC2-1').value, equipe2: document.getElementById('score-finaleC2-2').value }
    };

    for (const finaleId in scoresFinales) {
        set(ref(database, 'scores/' + finaleId), scoresFinales[finaleId]);
        // Pas de mise à jour de l'affichage ici, onValue s'en charge
    }


    // 7. Calculer et afficher le CLASSEMENT FINAL (1 à 8, avec gestion des égalités)
    let ranking = [];

    function addTeamsToRanking(team1, score1, team2, score2) {
        score1 = parseInt(score1 || 0);
        score2 = parseInt(score2 || 0);
        if (score1 > score2) {
            ranking.push(team1);
            ranking.push(team2);
        } else if (score2 > score1) {
            ranking.push(team2);
            ranking.push(team1);
        } else {
            ranking.push(team1, team2); // Égalité
        }
    }

    addTeamsToRanking(winnerDemi1, scoresFinales.finale1.equipe1, winnerDemi2, scoresFinales.finale1.equipe2);
    addTeamsToRanking(loserDemi1, scoresFinales.finale2.equipe1, loserDemi2, scoresFinales.finale2.equipe2);
    addTeamsToRanking(winnerDemiC1, scoresFinales.finale3.equipe1, winnerDemiC2, scoresFinales.finale3.equipe2);
    addTeamsToRanking(loserDemiC1_, scoresFinales.finale4.equipe1, loserDemiC2_, scoresFinales.finale4.equipe2);

    const finalRankingList = document.getElementById('final-ranking');
    finalRankingList.innerHTML = '';
    ranking.forEach((team, index) => {
        const listItem = document.createElement('li');
        listItem.textContent = `${index + 1}. ${team}`;
        finalRankingList.appendChild(listItem);
    });

    alert('Scores enregistrés avec succès'); // Message de confirmation
}

// -------------------------------------------------------------
//  GESTION DES INSCRIPTIONS (Capitaine + Joueurs)
// -------------------------------------------------------------

// Fonction pour inscrire une équipe (par le capitaine)
async function inscrireEquipe(event) {
    event.preventDefault();
    const form = document.getElementById('inscriptionForm');
    const messageDiv = document.getElementById('message');
    const loader = document.getElementById('formLoader');

    const nomEquipe = document.getElementById('nomEquipe').value.trim();
    const teamPassword = document.getElementById('teamPassword').value;
    const nomCapitaine = document.getElementById('nomCapitaine').value.trim();
    const prenomCapitaine = document.getElementById('prenomCapitaine').value.trim();
    const emailCapitaine = document.getElementById('emailCapitaine').value.trim();
    const telephoneCapitaine = document.getElementById('telephoneCapitaine').value.trim();
    const ageCapitaine = document.getElementById('ageCapitaine').value;
    const equipe = document.getElementById('equipe').value;

    // Validation (gardez votre validation existante)
    if (!nomEquipe || !teamPassword || !nomCapitaine || !prenomCapitaine || !emailCapitaine || !telephoneCapitaine || !ageCapitaine || !equipe) {
        messageDiv.innerHTML = '<p class="message error">Veuillez remplir tous les champs.</p>';
        return;
    }
    if (!/^[0-9]{10}$/.test(telephoneCapitaine)) {
        messageDiv.innerHTML = '<p class="message error">Veuillez rentrer un numéro de téléphone valide (10 chiffres).</p>';
        return;
    }
    if (isNaN(ageCapitaine) || ageCapitaine < 1 || ageCapitaine > 120) {
        messageDiv.innerHTML = '<p class="message error">L\'âge doit être un nombre compris entre 1 et 120.</p>';
        formLoader.style.display = 'none';
        return;
    }

    loader.style.display = 'block';

    try {
        // Vérification du nom d'équipe (gardez votre vérification Firebase existante)
        const equipesRef = ref(database, 'equipes');
        const snapshot = await get(equipesRef);
        if (snapshot.exists()) {
            const equipes = snapshot.val();
            for (const key in equipes) {
                if (equipes[key].nomEquipe === nomEquipe) {
                    messageDiv.innerHTML = '<p class="message error">Ce nom d\'équipe est déjà pris.</p>';
                    loader.style.display = 'none';
                    return;
                }
            }
        }

        // Enregistrement dans Firebase (gardez votre code existant)
        const equipeData = {
            nomEquipe: nomEquipe,
            motDePasse: teamPassword,
            capitaine: {
                nom: nomCapitaine,
                prenom: prenomCapitaine,
                email: emailCapitaine,
                telephone: telephoneCapitaine,
                age: ageCapitaine,
            },
            membres: {},
            dateInscription: serverTimestamp()
        };
        await set(ref(database, 'equipes/' + equipe), equipeData);
        messageDiv.innerHTML = `<p class="message success">Équipe "${nomEquipe}" inscrite avec succès!</p>`;

        //Mettre à jour dynamiquement le nom de l'équipe dans déroulement des matchs
        updateTeamNameInMatchDisplay(equipe, nomEquipe);
        loadTeams();

        form.reset();  // Réinitialiser le formulaire

        // Effacer les champs spécifiques pour une nouvelle inscription
        document.getElementById('nomEquipe').value = '';
        document.getElementById('teamPassword').value = '';
        document.getElementById('nomCapitaine').value = '';
        document.getElementById('prenomCapitaine').value = '';
        document.getElementById('emailCapitaine').value = '';
        document.getElementById('telephoneCapitaine').value = '';
        document.getElementById('ageCapitaine').value = '';
        document.getElementById('equipe').value = ''; // Réinitialiser la sélection de l'équipe


    } catch (error) {
            console.error("Erreur lors de l'inscription de l'équipe:", error);
            messageDiv.innerHTML = `<p class="message error">Erreur: ${error.message}</p>`;
    } finally {
        loader.style.display = 'none';
    }
}

//Fonction pour mettre à jour le nom de l'équipe dans déroulement des matchs
function updateTeamNameInMatchDisplay(equipeId, newTeamName) {
    // Extraire le numéro de l'équipe (ex: "equipe1" -> 1)
    const teamNumber = parseInt(equipeId.replace('equipe', ''));

    // Mettre à jour le nom dans le span correspondant
    const teamSpan = document.querySelector(`.team${teamNumber}-name`);
    if (teamSpan) {
        teamSpan.textContent = newTeamName;
    }
}

// Fonction pour charger et afficher les équipes (et leurs membres)
function loadTeams() {
    const equipesContainer = document.getElementById('equipes-container');
    equipesContainer.innerHTML = ''; // Efface le contenu précédent

    const equipesRef = ref(database, 'equipes');
    onValue(equipesRef, (snapshot) => {
        if (snapshot.exists()) {
            const equipes = snapshot.val();
            for (const equipeId in equipes) {
                const equipeData = equipes[equipeId];
                const equipeDiv = document.createElement('div');
                equipeDiv.className = 'equipe';
                equipeDiv.innerHTML = `<p>${equipeData.nomEquipe}</p>`;

                const membresList = document.createElement('ul');
                membresList.className = 'membres';

                // Affiche le capitaine
                const capitaineItem = document.createElement('li');
                capitaineItem.textContent = `Capitaine: ${equipeData.capitaine.prenom} ${equipeData.capitaine.nom}`;
                membresList.appendChild(capitaineItem);

                // Affiche les membres (s'il y en a)
                if (equipeData.membres) {
                    for (const membreId in equipeData.membres) {
                        const membre = equipeData.membres[membreId];
                        const membreItem = document.createElement('li');
                        membreItem.textContent = `${membre.prenom} ${membre.nom}`;
                         // Ajoute un bouton de suppression pour le capitaine
                        const deleteBtn = document.createElement('button');
                        deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        deleteBtn.className = 'delete-player-btn';
                        deleteBtn.onclick = () => deletePlayer(equipeId, membreId, equipeData.motDePasse);
                        membreItem.appendChild(deleteBtn);
                        membresList.appendChild(membreItem);
                    }
                } else {
                    membresList.innerHTML += '<li style="font-style: italic; color: #999;">Aucun joueur ajouté</li>';
                }
                equipeDiv.appendChild(membresList);

                // Formulaire pour ajouter un joueur (pour le capitaine)
                const addPlayerForm = document.createElement('form');
                addPlayerForm.className = 'team-management-form';
                addPlayerForm.innerHTML = `
                    <h3>Ajouter un joueur</h3>
                    <input type="text" placeholder="Prénom" data-field="prenom" required>
                    <input type="text" placeholder="Nom" data-field="nom" required>
                    <input type="password" placeholder="Mot de passe équipe" data-field="password" required>
                    <button type="submit">Ajouter</button>
                    <div class="message"></div>
                `;
                addPlayerForm.onsubmit = (event) => addPlayer(event, equipeId);
                equipeDiv.appendChild(addPlayerForm);

                equipesContainer.appendChild(equipeDiv);
            }
        } else {
            equipesContainer.innerHTML = '<p>Aucune équipe inscrite pour le moment.</p>';
        }
    });
}

// Fonction pour supprimer un joueur (par le capitaine)
async function deletePlayer(equipeId, membreId, teamPassword) {
    const enteredPassword = prompt("Entrez le mot de passe de l'équipe pour confirmer la suppression:");
    if (enteredPassword === teamPassword) {
        try {
            await remove(ref(database, `equipes/${equipeId}/membres/${membreId}`));
            alert('Joueur supprimé avec succès.');
            // Pas besoin de recharger, onValue s'en charge
        } catch (error) {
            console.error("Erreur lors de la suppression du joueur:", error);
            alert("Erreur lors de la suppression du joueur.");
        }
    } else {
        alert("Mot de passe incorrect.");
    }
}

async function addPlayer(event, equipeId) {
    event.preventDefault();
    const form = event.target;
    const messageDiv = form.querySelector('.message');
    const prenom = form.querySelector('[data-field="prenom"]').value.trim();
    const nom = form.querySelector('[data-field="nom"]').value.trim();
    const password = form.querySelector('[data-field="password"]').value;

    if (!prenom || !nom || !password) {
        messageDiv.innerHTML = '<p class="message error">Tous les champs sont obligatoires.</p>';
        return;
    }
    messageDiv.innerHTML = ''; // Efface les messages précédents

    try {
        // 1. Vérifier le mot de passe
        const equipeRef = ref(database, 'equipes/' + equipeId);
        const snapshot = await get(equipeRef);
        if (!snapshot.exists() || snapshot.val().motDePasse !== password) {
            messageDiv.innerHTML = '<p class="message error">Mot de passe incorrect.</p>';
            return;
        }

        // 2. Vérifier la limite de joueurs (5 membres + 1 capitaine = 6)
        const membres = snapshot.val().membres || {};
        if (Object.keys(membres).length >= 5) {
            messageDiv.innerHTML = '<p class="message error">Limite de joueurs atteinte (5 + capitaine).</p>';
            return;
        }

        // 3. Vérifier si le joueur existe déjà (dans n'importe quelle équipe!)
        const allTeamsRef = ref(database, 'equipes');
        const allTeamsSnapshot = await get(allTeamsRef);
        const allTeams = allTeamsSnapshot.val() || {};

        for (const teamId in allTeams) {
            const teamPlayers = allTeams[teamId].membres;
            if (teamPlayers) { // Vérifie si 'membres' existe
                for (const playerId in teamPlayers) {
                    const existingPlayer = teamPlayers[playerId];
                    if (existingPlayer.nom.toLowerCase() === nom.toLowerCase() &&
                        existingPlayer.prenom.toLowerCase() === prenom.toLowerCase()) {
                        messageDiv.innerHTML = '<p class="message error">Un joueur avec ce nom et prénom est déjà inscrit.</p>';
                        return; // Important : arrêter la fonction ici
                    }
                }
            }
        }

                // 4. Ajouter le joueur
                const newPlayerRef = push(ref(database, 'equipes/' + equipeId + '/membres'));
        await set(newPlayerRef, { prenom: prenom, nom: nom });
        messageDiv.innerHTML = '<p class="message success">Joueur ajouté!</p>';
        form.reset();

    } catch (error) {
        console.error("Erreur lors de l'ajout du joueur:", error);
        messageDiv.innerHTML = `<p class="message error">Erreur: ${error.message}</p>`;
    }
}

// Fonction pour réinitialiser les scores (ADMIN)
function resetScores() {
    const password = prompt("Entrez le mot de passe admin pour réinitialiser les scores:");
    if (password === 'ditib25five') {
        if (confirm('Êtes-vous sûr de vouloir réinitialiser TOUS les scores? Cette action est irréversible.')) {
            try {
                // Supprime TOUS les scores de Firebase
                remove(ref(database, 'scores'));

                // Réinitialise l'affichage des scores et des équipes dans le déroulement des matchs
                const scoreDisplays = document.querySelectorAll('.score-display');
                scoreDisplays.forEach(display => display.textContent = '');

                // Remet les noms d'équipe par défaut (Équipe 1, Équipe 2, etc.) dans les QUARTS DE FINALE
                for (let i = 1; i <= 8; i++) {
                    document.getElementById(`team${i}-name`).textContent = `Équipe ${i}`;
                }

                // Efface les noms d'équipe dans les DEMI-FINALES et FINALES
                const teamSpans = document.querySelectorAll('.match span[id^="demi"], .match span[id^="finale"]');
                teamSpans.forEach(span => span.textContent = '');

                //Efface le classement
                const finalRankingList = document.getElementById('final-ranking');
                finalRankingList.innerHTML = '';

                alert('Scores réinitialisés avec succès!');

            } catch (error) {
                console.error("Erreur lors de la réinitialisation des scores:", error);
                alert("Erreur lors de la réinitialisation des scores.");
            }
        }
    } else {
        alert("Mot de passe incorrect.");
    }
}

// Fonction pour afficher les numéros de téléphone des capitaines (mode admin)
function showCaptainPhoneNumbers() {
    const password = prompt("Entrez le mot de passe admin pour voir les numéros de téléphone:");

    if (password === 'ditib25five') {
        const equipesRef = ref(database, 'equipes');
        get(equipesRef).then((snapshot) => {
            if (snapshot.exists()) {
                const equipes = snapshot.val();
                let phoneNumbersHTML = '<h3>Numéros de téléphone des capitaines:</h3><ul>';

                for (const equipeId in equipes) {
                    const equipeData = equipes[equipeId];
                    phoneNumbersHTML += `<li>${equipeData.nomEquipe}: ${equipeData.capitaine.telephone}</li>`;
                }
                phoneNumbersHTML += '</ul>';

                // Afficher les numéros dans une div (vous pouvez améliorer le style/placement)
                const phoneNumbersDiv = document.createElement('div');
                phoneNumbersDiv.className = 'admin-form-container'; // Utilisez la même classe que pour le formulaire de scores
                phoneNumbersDiv.innerHTML = phoneNumbersHTML;
                document.getElementById('roadmap').appendChild(phoneNumbersDiv); // Ou un autre endroit approprié


            } else {
                alert('Aucune équipe inscrite.');
            }
        }).catch((error) => {
            console.error("Erreur lors de la récupération des numéros:", error);
            alert("Erreur lors de la récupération des numéros.");
        });
    } else {
        alert('Mot de passe incorrect.');
    }
}

// Gestion de la navigation et du défilement (inchangé)
const navItems = document.querySelectorAll('.bottom-nav a');
const sections = document.querySelectorAll('main > section');

function updateActiveNavItem() {
    let currentSectionId = '';
    let minDistance = Infinity;

    sections.forEach(section => {
        const rect = section.getBoundingClientRect();
        const distance = Math.abs(rect.top);

        if (distance < minDistance) {
            minDistance = distance;
            currentSectionId = section.id;
        }
    });

    navItems.forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('href') === `#${currentSectionId}`) {
            item.classList.add('active');
        }
    });
}

updateActiveNavItem();
window.addEventListener('scroll', updateActiveNavItem);

navItems.forEach(item => {
    item.addEventListener('click', function(event) {
        event.preventDefault();
        const targetId = this.getAttribute('href');
        const targetElement = document.querySelector(targetId);

        if (targetElement) {
            const navHeight = document.querySelector('.bottom-nav').offsetHeight;
            const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - navHeight + 10;
            window.scrollTo({ top: targetPosition, behavior: 'smooth' });
        }
    });
});




// Bouton de réinitialisation des ÉQUIPES (Admin)
const footer = document.querySelector('footer');
const resetButton = document.createElement('button');
resetButton.textContent = 'Réinitialiser les équipes (Admin)';
resetButton.className = 'cta-button';
resetButton.style.marginTop = '20px';
resetButton.style.backgroundColor = '#ff3c3c';

if (footer) {
    resetButton.addEventListener('click', function() {
        const password = prompt("Entrez le mot de passe pour réinitialiser les équipes :");
        if (password === 'ditib25five') { //  mot de passe
            if (confirm('Êtes-vous sûr de vouloir réinitialiser toutes les équipes ? Cette action est irréversible.')) {
                remove(ref(database, 'equipes'))
                    .then(() => {
                        // Réinitialise aussi les scores (appel de la fonction)
                        resetScores(); // Réinitialisation des scores *après* les équipes
                        alert('Toutes les équipes et les scores ont été réinitialisés.');
                        window.location.reload();
                    })
                    .catch((error) => {
                        console.error("Erreur lors de la réinitialisation:", error);
                        alert('Une erreur est survenue lors de la réinitialisation.');
                    });
            }
        } else if (password !== null) {
            alert('Mot de passe incorrect.');
        }
    });
    footer.appendChild(resetButton);
}


// Fonctionnalité de suppression de membre individuel (Admin)
function enableAdminMode() {
    const password = prompt("Entrez le mot de passe admin :");
    if (password === 'ditib25five') { //  mot de passe
        // Activer le mode admin
        const allPlayerItems = document.querySelectorAll('.membres li');
        allPlayerItems.forEach(item => {
            // Vérifie si l'élément li contient déjà un bouton de suppression
            if (!item.querySelector('.delete-player-btn')) {
                // Ajouter un bouton de suppression à chaque joueur
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.className = 'delete-player-btn';

                deleteBtn.addEventListener('click', function () {
                    const playerName = item.textContent.trim();
                    const equipeId = item.parentElement.parentElement.querySelector('p').textContent.trim();
                    const playerEmail = item.dataset.email;

                    if (confirm(`Êtes-vous sûr de vouloir supprimer ${playerName} ?`)) {
                        // Trouver et supprimer le joueur dans Firebase
                        const equipesRef = ref(database, 'equipes');
                        get(equipesRef).then((snapshot) => {
                            const equipes = snapshot.val() || {};
                            for (const key in equipes) {
                                if (equipes[key].nomEquipe === equipeId) {
                                    const teamPlayers = equipes[key].membres;
                                    if (teamPlayers) {
                                        for (const playerId in teamPlayers) {
                                            const player = teamPlayers[playerId];
                                            if (player.nom + " " + player.prenom === playerName) {
                                                remove(ref(database, 'equipes/' + key + '/membres/' + playerId))
                                                    .then(() => {
                                                        alert(`${playerName} a été supprimé avec succès.`);
                                                    })
                                                    .catch((error) => {
                                                        console.error("Erreur lors de la suppression:", error);
                                                        alert('Une erreur est survenue lors de la suppression.');
                                                    });
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                });

                item.appendChild(deleteBtn);
            }
        });

        alert('Mode admin activé. Vous pouvez maintenant supprimer des membres individuellement.');
    } else if (password !== null) {
        alert('Mot de passe incorrect.');
    }
}
// Ajouter un bouton pour activer le mode admin (dans le footer)
const adminButton = document.createElement('button');
adminButton.textContent = 'Mode Admin (Supprimer des membres)';
adminButton.className = 'cta-button';
adminButton.style.marginTop = '20px';
adminButton.style.backgroundColor = '#444';
adminButton.style.marginLeft = '10px';

adminButton.addEventListener('click', enableAdminMode);
footer.appendChild(adminButton);

// Gestion des étapes du tournoi (affichage)
const steps = document.querySelectorAll('.match-step');
const nextButton = document.getElementById('nextStep');
let currentStep = 0;

function showStep(stepIndex) {
    steps.forEach((step, index) => {
        if (index === stepIndex) {
            step.style.display = 'block';
            step.classList.add('active');
        } else {
            step.style.display = 'none';
            step.classList.remove('active');
        }
    });

    if (stepIndex === steps.length - 1) {
        nextButton.textContent = 'Recommencer';
    } else {
        nextButton.textContent = 'Étape suivante';
    }
}

if (nextButton) {
    nextButton.addEventListener('click', function() {
        currentStep = (currentStep + 1) % steps.length;
        showStep(currentStep);
    });
    showStep(0); // Afficher la première étape au chargement
}

// Chargement initial des données et démarrage
document.addEventListener('DOMContentLoaded', function() {
    startCountdown();
    loadTeams(); // Charger les équipes (et leurs joueurs)

      // Ajout de l'écouteur d'événements pour le formulaire d'inscription
    const inscriptionForm = document.getElementById('inscriptionForm');
    if (inscriptionForm) {
        inscriptionForm.addEventListener('submit', inscrireEquipe);
    }

    const adminScoreBtn = document.getElementById('adminScoreBtn');
    if (adminScoreBtn) {
        adminScoreBtn.addEventListener('click', showAdminScoreForm);
    }

    //Bouton reset
    const resetScoresBtn = document.getElementById('resetScoresBtn');
    if (resetScoresBtn) {
        resetScoresBtn.addEventListener('click', resetScores);
    }

      // Bouton pour afficher les numéros de téléphone (ADMIN)
    const showPhoneNumbersBtn = document.createElement('button');
    showPhoneNumbersBtn.textContent = 'Voir les numéros de téléphone (Admin)';
    showPhoneNumbersBtn.className = 'cta-button';
    showPhoneNumbersBtn.style.marginTop = '20px';
    showPhoneNumbersBtn.style.backgroundColor = '#444'; // Style distinctif
    showPhoneNumbersBtn.addEventListener('click', showCaptainPhoneNumbers);
    footer.appendChild(showPhoneNumbersBtn); // Ajoutez-le au footer, par exemple

    // Initialisation des écouteurs pour les scores des quarts de finale
    for (let i = 1; i <= 4; i++) {
        const matchRef = ref(database, `scores/match${i}`);
        onValue(matchRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                    document.getElementById(`score-match${i}`).innerHTML = `Score: ${data.equipe1} - ${data.equipe2}`;
            }
        });
    }
    // Écouteurs pour les demi-finales PRINCIPALES
    const demiPrincipale1Ref = ref(database, 'scores/demiPrincipale1');
    onValue(demiPrincipale1Ref, (snapshot) => {
        const data = snapshot.val();
            if (data) {
                document.getElementById('score-demi-finale-principale1').innerHTML = `Score: ${data.equipe1 || 0} - ${data.equipe2 || 0}`;
            }
    });

    const demiPrincipale2Ref = ref(database, 'scores/demiPrincipale2');
    onValue(demiPrincipale2Ref, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            document.getElementById('score-demi-finale-principale2').innerHTML = `Score: ${data.equipe1 || 0} - ${data.equipe2 || 0}`;
        }
    });

    // Écouteurs pour les demi-finales CONSOLANTES
    const demiConsolante1Ref = ref(database, 'scores/demiConsolante1');
    onValue(demiConsolante1Ref, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            document.getElementById('score-demi-finale-consolante1').innerHTML = `Score: ${data.equipe1 || 0} - ${data.equipe2 || 0}`;
        }
    });

    const demiConsolante2Ref = ref(database, 'scores/demiConsolante2');
    onValue(demiConsolante2Ref, (snapshot) => {
        const data = snapshot.val();
        if (data) {
                document.getElementById('score-demi-finale-consolante2').innerHTML = `Score: ${data.equipe1 || 0} - ${data.equipe2 || 0}`;
        }
    });
        // Écouteur pour la FINALE 1
    const finaleRef = ref(database, 'scores/finale1');
    onValue(finaleRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
                document.getElementById('score-finale').innerHTML = `Score: ${data.equipe1 || 0} - ${data.equipe2 || 0}`;
            }
    });

    // Écouteur pour la FINALE 2
const finale2Ref = ref(database, 'scores/finale2');
    onValue(finale2Ref, (snapshot) => {
    const data = snapshot.val();
    if (data) {
        document.getElementById('score-finale2').innerHTML = `Score: ${data.equipe1 || 0} - ${data.equipe2 || 0}`;
    }
});
// Écouteur pour la FINALE 3
const finale3Ref = ref(database, 'scores/finale3');
    onValue(finale3Ref, (snapshot) => {
    const data = snapshot.val();
    if (data) {
        document.getElementById('score-finale3').innerHTML = `Score: ${data.equipe1 || 0} - ${data.equipe2 || 0}`;
    }
});
// Écouteur pour la FINALE 4
const finale4Ref = ref(database, 'scores/finale4');
    onValue(finale4Ref, (snapshot) => {
    const data = snapshot.val();
    if (data) {
        document.getElementById('score-finale4').innerHTML = `Score: ${data.equipe1 || 0} - ${data.equipe2 || 0}`;
    }
});

   // Gestion de l'ajout au calendrier
   const addToCalendarBtn = document.getElementById('add-to-calendar-btn');
        if (addToCalendarBtn) {
            addToCalendarBtn.addEventListener('click', function() {
                // Création d'une boîte de dialogue modale (plus conviviale)
                const dialog = document.createElement('div');
                dialog.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: #222;
                    padding: 20px;
                    border: 1px solid #444;
                    border-radius: 8px;
                    z-index: 1000;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.5);
                `;

                dialog.innerHTML = `
                    <h3 style="margin-bottom: 15px; color: #00aaff;">Ajouter au calendrier</h3>
                    <p style="margin-bottom: 10px;">Choisissez votre type de calendrier :</p>
                    <button class="calendar-option" data-type="google">Google Calendar</button><br>
                    <button class="calendar-option" data-type="ics">Calendrier Apple / Outlook (.ics)</button><br>
                    <button class="calendar-cancel" style="margin-top: 15px; background-color: #ff3c3c;">Annuler</button>
                `;

                document.body.appendChild(dialog);

                // Gestion des clics sur les options
                dialog.querySelectorAll('.calendar-option').forEach(button => {
                    button.addEventListener('click', function() {
                        generateCalendarUrl(this.dataset.type);
                        document.body.removeChild(dialog); // Fermer la boîte de dialogue
                    });
                });

                // Gestion de l'annulation
                dialog.querySelector('.calendar-cancel').addEventListener('click', function() {
                    document.body.removeChild(dialog);
                });
            });
        }
    });
</script>
</body>
</html>
